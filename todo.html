<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="todo.css">
    <title>To-do</title>
</head>

<body>
    <div class="main">
        <h1>TODO-LIST</h1>
        <div class="container">
            <form action="to-do list" id="form-todo">
                <input type="text" name="content" id="content" placeholder="nama kegiatan">
                <textarea type="text" name="deskripsi" id="deskripsi" placeholder="deskripsi kegiatan"></textarea>
                <button type="submit" id="todo-submit">Submit</button>
            </form>
        </div>
        <ul id="todo-list">

        </ul>
    </div>
    <script>
        const form = document.getElementById('form-todo')
        const content = document.getElementById('content')
        const deskripsi = document.getElementById('deskripsi')
        const todolist = document.getElementById('todo-list')

        form.addEventListener('submit', function (e) {
            e.preventDefault()

            //alert todo jika belum terisi 
            const value = content.value
            const deskrip = deskripsi.value
            if (!value) {
                alert(" To do list harus di isi!")
                return
            }
            if (!deskrip) {
                alert("deskripsi nya isi ya!")
                return
            } alert("Todo berhasil di tambahkan")

            //simpan ke localstorage
            let todos = localStorage.getItem('todo'); // todo itu nama localstorage nya
            todos = todos ? JSON.parse(todos) : []

            todos.push({ value, deskrip })

            //simpan array yang baru ke di localstorage
            localStorage.setItem('todo', JSON.stringify(todos))
            console.log(todos)
            renderTodos() // manggil function
            content.value = ''
            deskripsi.value = ''

        })

        //render semua todo yang tersimpan di local storage
        function renderTodos() {
            const stored = localStorage.getItem('todo')
            const arr = stored ? JSON.parse(stored) : []
            todolist.innerHTML = ''
            arr.forEach(function (t, idx) {
                const li = document.createElement('li')

                const textWrap = document.createElement('div')

                const span = document.createElement('strong')
                span.textContent = t.value

                const descP = document.createElement('p')
                descP.textContent = t.deskrip

                //tombol edit 
                const editBtn = document.createElement('button')
                editBtn.type = 'button'
                editBtn.textContent = 'Edit'
                editBtn.style.marginLeft = 'auto' // biar button nya pindah ke kiri 
                editBtn.style.padding = '5px 10px'
                editBtn.style.border = 'none'
                editBtn.style.borderRadius = '8px'
                editBtn.style.backgroundColor = '#E4C087'


                //Edit mode 
                editBtn.addEventListener('click', function () {
                    const editWrapp = document.createElement('div')
                    editWrapp.style.display = 'flex'
                    editWrapp.style.flexDirection = 'column'
                    editWrapp.style.gap = '10px'
                    // editWrapp.style.flexGrow = '1'

                    const input = document.createElement('input')
                    input.type = 'text'
                    input.style.width = '400px'
                    input.style.margin = '12px'
                    // input.sty.display = 'block'
                    input.value = t.value

                    const desInput = document.createElement('textarea')
                    desInput.type = 'text'
                    desInput.style.width = '500px'
                    desInput.style.height = '60px'
                    desInput.value = t.deskrip


                    // Tombol save button 
                    const svBtn = document.createElement('button');
                    svBtn.type = 'button';
                    svBtn.style.marginLeft = 'auto' // biar button nya pindah ke kiri 
                    svBtn.style.padding = '5px 10px'
                    svBtn.style.border = 'none'
                    svBtn.style.borderRadius = '8px'
                    svBtn.style.backgroundColor = '#4988C4'
                    svBtn.style.color = '#ffff'
                    svBtn.textContent = 'Save';

                    // Tombol cancel 
                    const cancelBtn = document.createElement('button');
                    cancelBtn.type = 'button';
                    cancelBtn.style.margin = '5px' // biar button nya pindah ke kiri 
                    cancelBtn.style.padding = '5px 10px'
                    cancelBtn.style.border = 'none'
                    cancelBtn.style.borderRadius = '8px'
                    cancelBtn.style.backgroundColor = '#607B8F'
                    cancelBtn.style.color = '#ffff'
                    cancelBtn.textContent = 'Cancel';

                    //klik manual button cancel 
                    cancelBtn.addEventListener('click', function () {
                        renderTodos();
                    })


                    // klik esc untuk cancel 
                    document.addEventListener('keydown', function (event) {
                        if (event.key === 'Escape') {
                            event.preventDefault()
                            cancelBtn.click()
                        }
                    })

                    // save manual 
                    svBtn.addEventListener('click', function () {
                        const newVal = { value: input.value, deskrip: desInput.value }
                        if (confirm('Yakin todo ini di edit?')) {
                            console.log(newVal)
                            if (newVal) {
                                const current = localStorage.getItem('todo')
                                const listArr = current ? JSON.parse(current) : []

                                listArr[idx] = newVal
                                localStorage.setItem('todo', JSON.stringify(listArr))
                                renderTodos()
                                console.log(listArr)
                            }
                        }
                    })

                    // klik enter untuk save 
                    input.addEventListener('keydown', function (event) {
                        if (event.key === 'Enter') {
                            event.preventDefault();
                            svBtn.click();
                        }
                    });


                    cancelBtn.addEventListener('click', function () {
                        renderTodos();
                    })

                    // Tambah input, tombol save, ketika edit di klik 
                    li.innerHTML = '';
                    li.appendChild(input)
                    li.appendChild(desInput)
                    li.appendChild(svBtn)
                    li.appendChild(cancelBtn)
                    input.focus(); // bisa langsung isi ketika kita ingin mengetik 
                })


                // tombol delete 
                const deleteBtn = document.createElement('button');
                deleteBtn.textContent = 'delete'
                deleteBtn.type = 'button'
                deleteBtn.style.padding = '5px 10px'
                deleteBtn.style.marginLeft = '5px'
                deleteBtn.style.position = 'right'
                deleteBtn.style.border = 'none'
                deleteBtn.style.borderRadius = '8px'
                deleteBtn.style.backgroundColor = '#FA6868'
                deleteBtn.style.color = '#ffff'
                deleteBtn.addEventListener('click', function () {
                    if (confirm('Yakin ingin di hapus?')) {
                        alert('todo berhasil di hapus')
                        arr.splice(idx, 1)
                        localStorage.setItem('todo', JSON.stringify(arr))
                        renderTodos()
                    }
                })

                // di simpan jadi satu content di textWrapp
                textWrap.appendChild(span)
                textWrap.appendChild(descP)

                
                li.appendChild(textWrap)
                li.appendChild(editBtn)
                li.appendChild(deleteBtn)
                todolist.appendChild(li)
            });
        }
        renderTodos();
    </script>
</body>

</html>